shadow$provide["module$node_modules$draft_js$lib$convertFromRawToDraftState"]=function(global,process,require,module,exports,shadow$shims){var _assign=require("module$node_modules$object_assign$index");var _extends=_assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)if(Object.prototype.hasOwnProperty.call(source,key))target[key]=source[key]}return target};var ContentBlock=require("module$node_modules$draft_js$lib$ContentBlock");var ContentBlockNode=
require("module$node_modules$draft_js$lib$ContentBlockNode");var ContentState=require("module$node_modules$draft_js$lib$ContentState");var DraftEntity=require("module$node_modules$draft_js$lib$DraftEntity");var DraftFeatureFlags=require("module$node_modules$draft_js$lib$DraftFeatureFlags");var DraftTreeAdapter=require("module$node_modules$draft_js$lib$DraftTreeAdapter");var Immutable=require("module$node_modules$immutable$dist$immutable");var SelectionState=require("module$node_modules$draft_js$lib$SelectionState");
var createCharacterList=require("module$node_modules$draft_js$lib$createCharacterList");var decodeEntityRanges=require("module$node_modules$draft_js$lib$decodeEntityRanges");var decodeInlineStyleRanges=require("module$node_modules$draft_js$lib$decodeInlineStyleRanges");var generateRandomKey=require("module$node_modules$draft_js$lib$generateRandomKey");var invariant=require("module$node_modules$fbjs$lib$invariant");var experimentalTreeDataSupport=DraftFeatureFlags.draft_tree_data_support;var List=
Immutable.List,Map=Immutable.Map,OrderedMap=Immutable.OrderedMap;var decodeBlockNodeConfig=function decodeBlockNodeConfig(block,entityMap){var key=block.key,type=block.type,data=block.data,text=block.text,depth=block.depth;var blockNodeConfig={text:text,depth:depth||0,type:type||"unstyled",key:key||generateRandomKey(),data:Map(data),characterList:decodeCharacterList(block,entityMap)};return blockNodeConfig};var decodeCharacterList=function decodeCharacterList(block,entityMap){var text=block.text,
rawEntityRanges=block.entityRanges,rawInlineStyleRanges=block.inlineStyleRanges;var entityRanges=rawEntityRanges||[];var inlineStyleRanges=rawInlineStyleRanges||[];return createCharacterList(decodeInlineStyleRanges(text,inlineStyleRanges),decodeEntityRanges(text,entityRanges.filter(function(range){return entityMap.hasOwnProperty(range.key)}).map(function(range){return _extends({},range,{key:entityMap[range.key]})})))};var addKeyIfMissing=function addKeyIfMissing(block){return _extends({},block,{key:block.key||
generateRandomKey()})};var updateNodeStack=function updateNodeStack(stack,nodes,parentRef){var nodesWithParentRef=nodes.map(function(block){return _extends({},block,{parentRef:parentRef})});return stack.concat(nodesWithParentRef.reverse())};var decodeContentBlockNodes=function decodeContentBlockNodes(blocks,entityMap){return blocks.map(addKeyIfMissing).reduce(function(blockMap,block,index){!Array.isArray(block.children)?"development"!=="production"?invariant(false,"invalid RawDraftContentBlock can not be converted to ContentBlockNode"):
invariant(false):void 0;var children=block.children.map(addKeyIfMissing);var contentBlockNode=new ContentBlockNode(_extends({},decodeBlockNodeConfig(block,entityMap),{prevSibling:index===0?null:blocks[index-1].key,nextSibling:index===blocks.length-1?null:blocks[index+1].key,children:List(children.map(function(child){return child.key}))}));blockMap=blockMap.set(contentBlockNode.getKey(),contentBlockNode);var stack=updateNodeStack([],children,contentBlockNode);while(stack.length>0){var node=stack.pop();
var parentRef=node.parentRef;var siblings=parentRef.getChildKeys();var _index=siblings.indexOf(node.key);var isValidBlock=Array.isArray(node.children);if(!isValidBlock){!isValidBlock?"development"!=="production"?invariant(false,"invalid RawDraftContentBlock can not be converted to ContentBlockNode"):invariant(false):void 0;break}var _children=node.children.map(addKeyIfMissing);var _contentBlockNode=new ContentBlockNode(_extends({},decodeBlockNodeConfig(node,entityMap),{parent:parentRef.getKey(),children:List(_children.map(function(child){return child.key})),
prevSibling:_index===0?null:siblings.get(_index-1),nextSibling:_index===siblings.size-1?null:siblings.get(_index+1)}));blockMap=blockMap.set(_contentBlockNode.getKey(),_contentBlockNode);stack=updateNodeStack(stack,_children,_contentBlockNode)}return blockMap},OrderedMap())};var decodeContentBlocks=function decodeContentBlocks(blocks,entityMap){return OrderedMap(blocks.map(function(block){var contentBlock=new ContentBlock(decodeBlockNodeConfig(block,entityMap));return[contentBlock.getKey(),contentBlock]}))};
var decodeRawBlocks=function decodeRawBlocks(rawState,entityMap){var isTreeRawBlock=Array.isArray(rawState.blocks[0].children);var rawBlocks=experimentalTreeDataSupport&&!isTreeRawBlock?DraftTreeAdapter.fromRawStateToRawTreeState(rawState).blocks:rawState.blocks;if(!experimentalTreeDataSupport)return decodeContentBlocks(isTreeRawBlock?DraftTreeAdapter.fromRawTreeStateToRawState(rawState).blocks:rawBlocks,entityMap);return decodeContentBlockNodes(rawBlocks,entityMap)};var decodeRawEntityMap=function decodeRawEntityMap(rawState){var rawEntityMap=
rawState.entityMap;var entityMap={};Object.keys(rawEntityMap).forEach(function(rawEntityKey){var _rawEntityMap$rawEnti=rawEntityMap[rawEntityKey],type=_rawEntityMap$rawEnti.type,mutability=_rawEntityMap$rawEnti.mutability,data=_rawEntityMap$rawEnti.data;entityMap[rawEntityKey]=DraftEntity.__create(type,mutability,data||{})});return entityMap};var convertFromRawToDraftState=function convertFromRawToDraftState(rawState){!Array.isArray(rawState.blocks)?"development"!=="production"?invariant(false,"invalid RawDraftContentState"):
invariant(false):void 0;var entityMap=decodeRawEntityMap(rawState);var blockMap=decodeRawBlocks(rawState,entityMap);var selectionState=blockMap.isEmpty()?new SelectionState:SelectionState.createEmpty(blockMap.first().getKey());return new ContentState({blockMap:blockMap,entityMap:entityMap,selectionBefore:selectionState,selectionAfter:selectionState})};module.exports=convertFromRawToDraftState}
//# sourceMappingURL=module$node_modules$draft_js$lib$convertFromRawToDraftState.js.map
